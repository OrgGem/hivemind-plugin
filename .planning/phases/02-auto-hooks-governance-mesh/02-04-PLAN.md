---
phase: 02-auto-hooks-governance-mesh
plan: 04
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - src/lib/detection.ts
  - src/hooks/soft-governance.ts
  - src/hooks/session-lifecycle.ts
  - src/hooks/tool-gate.ts
  - tests/evidence-gate.test.ts
  - tests/soft-governance.test.ts
  - tests/framework-context.test.ts
  - tests/governance-stress.test.ts
autonomous: true

must_haves:
  truths:
    - "After 10+ unacknowledged cycles, governance escalates to IGNORED tier with error-level pressure"
    - "IGNORED argue-back contains sequence, plan, and hierarchy evidence in one compact block"
    - "Rare block-mode is simulated only when prerequisite failure and medium/high impact both occur"
    - "All 13 governance stress conditions pass in automated output"
  artifacts:
    - path: "src/lib/detection.ts"
      provides: "IGNORED-tier compiler with required tri-evidence block"
      contains: "IGNORED"
    - path: "src/hooks/tool-gate.ts"
      provides: "Simulated block + rollback guidance path"
      contains: "rollback guidance"
    - path: "tests/governance-stress.test.ts"
      provides: "13-condition governance stress validation for GOV-01..GOV-08"
      min_lines: 120
  key_links:
    - from: "src/hooks/soft-governance.ts"
      to: "src/lib/detection.ts"
      via: "increment and evaluate IGNORED escalation counters"
      pattern: "compileIgnoredTier"
    - from: "src/hooks/session-lifecycle.ts"
      to: "src/lib/detection.ts"
      via: "render compact tri-evidence argue-back block"
      pattern: "formatIgnoredEvidence"
---

<objective>
Complete IGNORED-tier enforcement and verify full governance behavior with a deterministic stress suite.

Purpose: Complete GOV-08 while preserving deferred no-hard-block policy and proving simulated block-mode and rollback guidance behavior under the locked conditions.

Output: IGNORED-tier argue-back implementation plus governance stress tests covering GOV-01..GOV-08 and locked context decisions.
</objective>

<execution_context>
@/Users/apple/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/apple/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-auto-hooks-governance-mesh/02-RESEARCH.md
@docs/plans/STRESS-TEST-1.MD

@src/lib/detection.ts
@src/hooks/soft-governance.ts
@src/hooks/session-lifecycle.ts
@src/hooks/tool-gate.ts
@tests/evidence-gate.test.ts
@tests/soft-governance.test.ts
@tests/framework-context.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement IGNORED-tier argue-back with locked tri-evidence contract</name>
  <files>src/lib/detection.ts, src/hooks/soft-governance.ts, src/hooks/session-lifecycle.ts, tests/evidence-gate.test.ts, tests/soft-governance.test.ts</files>
  <action>Implement IGNORED escalation when 10+ unacknowledged cycles accumulate, using settings-aware tone adaptation and expertise-level adaptation. Enforce required evidence bundle in one compact block every time IGNORED fires: (1) sequence evidence (declared vs actual action order), (2) plan evidence (missing prerequisites/undone tasks), and (3) hierarchy evidence (trajectory/tactic/action mismatch). Implement hybrid reset policy: acknowledgment can downgrade severity, full reset only after prerequisites are complete, with thresholds based on missed-step count and hierarchy impact.</action>
  <verify>Run `npx tsx --test tests/evidence-gate.test.ts` and `npx tsx --test tests/soft-governance.test.ts`.</verify>
  <done>IGNORED behavior escalates at locked threshold, always includes tri-evidence block, and reset/downgrade rules match locked policy.</done>
</task>

<task type="auto">
  <name>Task 2: Add full governance stress suite including simulated block-mode constraints</name>
  <files>src/hooks/tool-gate.ts, tests/framework-context.test.ts, tests/governance-stress.test.ts</files>
  <action>Implement and test rare simulated block-mode behavior only when both conditions are true: prerequisite failure exists and impact is medium/high. Enforce no true hard-deny (deferred idea remains excluded) by returning simulated-block messaging plus post-action rollback guidance. Build `tests/governance-stress.test.ts` with 13 explicit PASS/FAIL conditions covering GOV-01..08, locked framework conflict routing, toast severities, and IGNORED evidence/tone behavior.</action>
  <verify>Run `npx tsx --test tests/governance-stress.test.ts` and confirm all 13 checks pass.</verify>
  <done>Stress harness reports 13/13 PASS with clear diagnostics and validates simulated block-mode restrictions without introducing hard tool denial.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npx tsx --test tests/evidence-gate.test.ts` passes with tri-evidence IGNORED assertions
3. `npx tsx --test tests/soft-governance.test.ts` passes with settings-aware reset/downgrade behavior
4. `npx tsx --test tests/framework-context.test.ts` passes with simulated pause/limited-mode checks
5. `npx tsx --test tests/governance-stress.test.ts` reports 13/13 PASS
5. `npm test` passes end-to-end
</verification>

<success_criteria>
- GOV-08 satisfied: IGNORED tier triggers at 10+ unacknowledged warning cycles with compact tri-evidence argue-back
- Phase 2 stress objective satisfied: all 13 governance stress conditions are automated and PASS
- Locked decision fidelity: simulated block-mode is applied only under dual-condition gate and never as true hard denial
- ST11/ST12 regressions prevented by dedicated stress assertions
</success_criteria>

<output>
After completion, create `.planning/phases/02-auto-hooks-governance-mesh/02-04-SUMMARY.md`
</output>
