---
phase: 02-auto-hooks-governance-mesh
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/detection.ts
  - src/schemas/brain-state.ts
  - src/hooks/session-lifecycle.ts
  - tests/detection.test.ts
  - tests/integration.test.ts
autonomous: true

must_haves:
  truths:
    - "Governance guidance appears from turn 0 in strict, assisted, and permissive modes"
    - "Permissive mode still receives navigation context while suppressing detection-pressure warnings"
    - "Violation seriousness is scored from intent, hierarchy, and role metadata mismatches"
  artifacts:
    - path: "src/hooks/session-lifecycle.ts"
      provides: "Turn-window bootstrap and mode-aware signal rendering"
      contains: "turn_count <= 2"
    - path: "src/lib/detection.ts"
      provides: "Severity mapping and seriousness scoring helpers"
      contains: "out_of_order"
    - path: "src/schemas/brain-state.ts"
      provides: "Governance counters for repeated warnings and acknowledgments"
      contains: "governance_counters"
  key_links:
    - from: "src/hooks/session-lifecycle.ts"
      to: "src/lib/detection.ts"
      via: "shared severity + seriousness compiler"
      pattern: "compileGovernanceSignals"
    - from: "src/lib/detection.ts"
      to: "src/schemas/brain-state.ts"
      via: "counter escalation and reset policy"
      pattern: "acknowledged"
---

<objective>
Build the shared governance signal model and turn-0 prompt behavior that all later hooks consume.

Purpose: Satisfy GOV-01, GOV-02, and GOV-03 while establishing the locked severity mapping and seriousness inputs required by later plans.

Output: Updated detection and brain-state models plus session-lifecycle rendering that boots in every mode and preserves permissive silent-tracking boundaries.
</objective>

<execution_context>
@/Users/apple/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/apple/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-auto-hooks-governance-mesh/02-RESEARCH.md

@src/lib/detection.ts
@src/schemas/brain-state.ts
@src/hooks/session-lifecycle.ts
@tests/detection.test.ts
@tests/integration.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement locked severity mapping and seriousness scoring primitives</name>
  <files>src/lib/detection.ts, src/schemas/brain-state.ts, tests/detection.test.ts</files>
  <action>Add governance-signal primitives that encode the locked severity mapping exactly: out-of-order tool use (`info` → `warning` → `error`), drift (`warning` → `error`), compaction (`info` only), evidence-gate pressure (`warning` → `error`), and IGNORED tier (`error`). Add seriousness scoring that combines declared-intent mismatch, hierarchy mismatch, and role-metadata mismatch. Extend brain-state metrics with counters needed for repetition escalation, acknowledgment downgrade, and full-reset gating (full reset only after prerequisite completion). Keep all logic in `src/lib` SDK-free.</action>
  <verify>Run `npx tsx --test tests/detection.test.ts` and confirm new severity/seriousness/reset assertions pass.</verify>
  <done>Detection layer returns deterministic severity and seriousness outputs for all locked decision cases, and state schema supports settings-aware escalation/reset tracking.</done>
</task>

<task type="auto">
  <name>Task 2: Rework turn-0 lifecycle injection and permissive navigation behavior</name>
  <files>src/hooks/session-lifecycle.ts, tests/integration.test.ts</files>
  <action>Refactor lifecycle prompt assembly so bootstrap and evidence/team guidance are gated by early turn window (`turn_count <= 2`) in all governance modes, not by lock status. In permissive mode, continue showing navigation context (declared intent, hierarchy position, next expected step), but suppress detection-pressure warnings beyond allowed informational guidance. Keep compaction notice channel informational only. Include language-routing hooks so tool names remain English while surrounding text can localize per configured language.</action>
  <verify>Run `npx tsx --test tests/integration.test.ts` and verify strict/assisted/permissive turn-0 behavior and permissive suppression assertions.</verify>
  <done>Turn-0 guidance works in all modes, permissive mode remains silent-tracking for warnings yet still provides navigation context, and rendering is ready for hybrid-language output.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npx tsx --test tests/detection.test.ts` passes with severity/seriousness coverage
3. `npx tsx --test tests/integration.test.ts` passes with turn-0 and permissive navigation assertions
</verification>

<success_criteria>
- GOV-01 satisfied: bootstrap triggers in all governance modes with turn-window gate
- GOV-02 satisfied: evidence/team guidance appears from turn 0 unconditionally
- GOV-03 satisfied: permissive mode suppresses warning-pressure rendering while preserving navigation context
- Locked decision fidelity: severity mapping and seriousness inputs are centrally defined for reuse by all hooks
</success_criteria>

<output>
After completion, create `.planning/phases/02-auto-hooks-governance-mesh/02-01-SUMMARY.md`
</output>
